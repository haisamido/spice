networks:
  spice-network:
    driver: bridge

services:
  spice-api:
    build:
      context: ${CONTAINER_CONTEXT:-.}
      dockerfile: ${CONTAINER_FILE:-Containerfile}
    image: ${CONTAINER_IMAGE:-spice-builder}:${CONTAINER_TAG:-latest}
    container_name: ${CONTAINER_NAME:-spice-api}
    ports:
      - "${SERVICE_HOST_PORT:-50000}:${SERVICE_PORT:-50000}"
    environment:
      - PORT=${SERVICE_PORT:-50000}
      - GIT_COMMIT=${GIT_COMMIT:-}
      - SGP4_POOL_SIZE=${SGP4_POOL_SIZE:-12}
    networks:
      - spice-network
    restart: unless-stopped

  spice-api-native:
    build:
      context: ${CONTAINER_CONTEXT:-.}
      dockerfile: Containerfile.native
    image: ${CONTAINER_IMAGE:-spice-builder}:native
    container_name: ${CONTAINER_NAME_NATIVE:-spice-api-native}
    ports:
      - "${NATIVE_HOST_PORT:-50001}:50001"
    environment:
      - NATIVE_PORT=50001
      - GIT_COMMIT=${GIT_COMMIT:-}
      - SGP4_POOL_SIZE=${SGP4_POOL_SIZE:-12}
    networks:
      - spice-network
    restart: unless-stopped
    profiles:
      - native
